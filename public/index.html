<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <!-- Preload –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤ -->
    <link
      rel="preload"
      href="/data/core.json"
      as="fetch"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/data/translations.json"
      as="fetch"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/data/lang.json"
      as="fetch"
      crossorigin="anonymous"
    />

    <!-- Preconnect –¥–æ –¥–æ–º–µ–Ω—ñ–≤ -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Preload —à—Ä–∏—Ñ—Ç—ñ–≤ -->
    <!-- <link
      rel="preload"
      href="/font/your-font.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    /> -->
    <!-- <link rel="icon" href="%PUBLIC_URL%/favicon.ico" /> -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìñ</text></svg>"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- <link rel="manifest" href="%PUBLIC_URL%/manifest.json" /> -->

    <title>Under-word-app</title>
  </head>
  <body>
    <div id="root">
      <!-- –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏–≤–∞—é—á–∏–º </body> -->
      <script>
        // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è Service Worker
        if ("serviceWorker" in navigator) {
          window.addEventListener("load", () => {
            navigator.serviceWorker
              .register("/sw.js", {
                scope: "/",
                updateViaCache: "none", // –ó–∞–≤–∂–¥–∏ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –∑ –º–µ—Ä–µ–∂—ñ
              })
              .then((registration) => {
                console.log(
                  "‚úÖ Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ:",
                  registration.scope
                );

                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
                registration.addEventListener("updatefound", () => {
                  const newWorker = registration.installing;
                  console.log("üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è Service Worker");

                  newWorker.addEventListener("statechange", () => {
                    if (
                      newWorker.state === "installed" &&
                      navigator.serviceWorker.controller
                    ) {
                      // –ù–æ–≤–∞ –≤–µ—Ä—Å—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞
                      if (confirm("–î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞ –≤–µ—Ä—Å—ñ—è –¥–æ–¥–∞—Ç–∫–∞. –û–Ω–æ–≤–∏—Ç–∏?")) {
                        window.location.reload();
                      }
                    }
                  });
                });
              })
              .catch((error) => {
                console.log("‚ùå –ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó Service Worker:", error);
              });

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—É –≥–æ–¥–∏–Ω—É
            setInterval(() => {
              if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({
                  type: "CHECK_UPDATE",
                });
              }
            }, 60 * 60 * 1000);
          });
        }

        // –û—á–∏—Å—Ç–∫–∞ –∫–µ—à—É (–¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏)
        if (process.env.NODE_ENV === "development") {
          window.clearAppCache = () => {
            if (
              "serviceWorker" in navigator &&
              navigator.serviceWorker.controller
            ) {
              navigator.serviceWorker.controller.postMessage({
                type: "CLEAR_CACHE",
              });
              console.log("üßπ –ó–∞–ø–∏—Ç –Ω–∞ –æ—á–∏—Å—Ç–∫—É –∫–µ—à—É –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ");
            }
          };
        }
      </script>
    </div>
  </body>
</html>
